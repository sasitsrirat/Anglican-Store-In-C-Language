#include <stdio.h>
#include <string.h>
#include <conio.h>
#include <windows.h>
#include <stdlib.h>
#include <time.h>
void txtcolor(int txt, int back)
{
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), back * 16 + txt);
}
void resetc(void)
{
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 15);
}
void saygoodbye();
void load(int l)
{
    int i;

    printf("\n\n\t--------------LOADING--------------\n");
    printf("\t___________________________________\n\n");
    printf("\t");
    for (i = 0; i < l; i++)
    {
        txtcolor(0,20);
        printf(" "); //showspaceinloading
        resetc();    //anticolorofloading
    }
    printf("\n\t___________________________________\n");
}
void main()
{
    char username[50];
    int program, order, sum = 0, i = 0,checkpassword,check;
    char clear = {0} ;

    struct customer
    {
        char name[50];
        int password;
        int debit;
    }ct;

    for (int countload = 0; countload < 36; countload++) //lengthofloading
    {
        load(countload);
        Sleep(50); //timeofloading
        system("cls");
    }

    FILE *pt;
    pt = fopen("user.txt","a+");
    
    printf("Enter Username : "); scanf("%[^\n]",username);

    while(!feof(pt))
    {
        fscanf(pt,"%s%d%d",ct.name,&ct.password,&ct.debit);
        if (strcmp(ct.name,username)==0) //if name & username math
        {
            printf("----------------------------------------");
            printf("\n\tWellcome Back!! %s",ct.name);
            printf("\n----------------------------------------");
            check = 1;

            do{
                printf("\nEnter password : "); scanf("%d",&checkpassword);
                if(checkpassword==ct.password) break;
                if(checkpassword != ct.password)
                {
                    printf("-----------------------------------------------");
                    printf("\n Wrong password Please Enter password again!");
                    printf("\n-----------------------------------------------");    
                }
            }while(checkpassword != ct.password);
        }
    }

    if(check==0)
    {
        printf("---------------------------");
        printf("\n== Wellcome to our shop ==");
        printf("\nEnter you new password (4 Number Only): ");
        scanf("%d",&checkpassword);
    }
    system("cls");
    srand(time(NULL));
    printf("------------------------------------\n");
    printf("WELCOME TO PROTECTORS ORGANIZATIONS\n");
    printf("------------------------------------\n");

    //start programs
    do
    {   printf("Number of your order : %d \n", i);
        printf("Cost : %d \n", sum);
        printf("------------------------------------\n");
        printf("           Name of programs         \n");
        printf("------------------------------------\n");
        printf("\n|          Anglican Shop         1 |\n"); // ร้านขายของของ
        printf("|          Corpserve             2 |\n");   // รับศพไร้ญาติ
        printf("|          Church Delivery       3 |\n");   // บริการจองรถขนศพ
        printf("|          High-Low Heresy       4 |\n");   //คำนวนบุญบาป
        printf("|          Exit program          5 |\n");   //คำนวนบุญบาป

        do
        {
            printf("Select programs by press number : ");
            scanf("%d", &program);
            if (program != 1 && program != 2 && program != 3 && program != 4 && program != 5)
            {
                printf("----------------------------------------------------------------------------\n");
                txtcolor(12, 0);
                printf("                    Error!!! Please try again \n");
                resetc();
                printf("----------------------------------------------------------------------------\n");
            }
        } while (program != 1 && program != 2 && program != 3 && program != 4 && program != 5);

        switch (program)
        {
            case 1:
            {
                do
                {
                    resetc();
                    printf("\n----------------------------------------------------------------------------\n");
                    txtcolor(14, 0);
                    printf("   + Anglican Shop\n");
                    resetc();
                    printf("   1 Holy water             150THB\n");
                    printf("   2 Gun of heaven          990THB\n");
                    printf("   3 Crucifix Mhor-Praa     80THB\n");
                    printf("   4 Bible Book             50THB\n");
                    printf("   5 Necklace of God        600THB\n");
                    printf("   6 Reset order\n");
                    txtcolor(12, 0);
                    printf("   0 Back\n");
                    resetc();

                    do
                    {
                        printf("\nSelect your order : ");
                        scanf("%d", &order);
                        if (order != 0 && order != 1 && order != 2 && order != 3 && order != 4 && order != 5 && order != 6)
                        {
                            txtcolor(12, 0);
                            printf("--->Error !!! Please try again<--- \n");
                            resetc();
                        }
                    } while (order != 0 && order != 1 && order != 2 && order != 3 && order != 4 && order != 5 && order != 6);

                    switch (order)
                    {
                        case 0: i--; break;
                        case 1: sum += 150; break;
                        case 2: sum += 990; break;
                        case 3: sum += 80; break;
                        case 4: sum += 50; break;
                        case 5: sum += 600; break;
                        case 6: sum = 0; i = 0; i--; break;
                    } i++;
                    system("cls");
                    printf("Number of your order : %d \n", i);
                    printf("Cost : %d \n", sum);
                } while (order != 0); //หลุดloopcase1
                system("cls");
            }break;

            case 2: //program 2
            {
                printf(" ");
            }break;
            case 3: //program 3
            {
                printf(" ");
            }break;
            case 4: //program 4
            {
                printf(" ");
            }break;
            default:
            {
                if (sum >= 10)
                {
                    printf("------------------------------------\n");
                    txtcolor(12, 0);
                    printf("!! Check out your order !! \n");
                    printf("if you need to quit please clear your order.\n");
                    resetc();
                    printf("------------------------------------\n");
                    printf("Clear orders[y] or Continuous shoping[n] : ");
                    do
                    {
                    scanf("%c",&clear); //strlwr(clear);
                        if (clear == 'y')
                        {
                            sum = 0; i = 0;
                        }
                        if (clear != 'y'){
                            printf("Error!! input again : ");
                        }
                    }while(clear != 'y' && clear != 'n');
                    system("cls");
                }
                else if (sum == 0){
                    saygoodbye();
                    exit(0);}
            }
        }
    }while (5);
}

void saygoodbye()
{
    printf("------------------------------------\n");
    printf("         === >GOODBYE < ===         \n");
    printf("              > ^-^ <               \n");
    printf("------------------------------------\n");
}
